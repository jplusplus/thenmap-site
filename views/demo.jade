extends ./layout.jade

block title
  title Demonstrations of thenmap.js

block content
  header
    .back #[a(href="//www.thenmap.net") &larr; Back to main page]
    h1 thenmap.js
  p.intro
    <b>thenmap.js</b> is a simple javascript library for accessing the <a href="//api.thenmap.net">Thenmap API</a>. For the full documentation, please see <a href="https://github.com/rotsee/thenmap-js">github.com/rotsee/thenmap-js</a>.

  form(method='get',name="form")
    div
      label(for='dataset') Dataset
      select(name="dataset",id="dataset",onchange="this.form.submit()")
        each dataset in availableDatasets
          option(value=dataset, selected=activeDataset == dataset) #{dataset}
      p See <a href="//api.thenmap.net#datasets">api.thenmap.net</a> for a description of available datasets

    div
      label(for="date") Date
      input(type="date", name="date", id="date" value=date)

    div
      label(for="language") Language
      select(name="language", id="language")
        each language in datasetInfo.languages
          option(value=language, selected=language == activeLanguage) #{language}

    div
      label(for="projection") Projection
      input(name="projection", id="projection", value=requestedProjection)
      p Recommended projections for this dataset: <code>#{datasetInfo.recommendedProjections}</code>
      small
        label(for="allow_all") Allow non recommended projections?
          input(type="checkbox", name="allow_all", id="allow_all", checked=(allow_all === "on"), style="margin-left:.8em")

    div
        label(for="width") Width
        input(name="width", id="width", value=width)
        label(for="height") Height
        input(name="height", id="height", value=height)
        p Size in pixels

    div
        label(for="dataKey") Datakey (Google sheets ID)
        input(name="dataKey", id="dataKey", value=activeDatakey)
        p See the #[a(href="https://docs.google.com/spreadsheets/d/1dj8qw3I75qudflfkr4wBDipeehnecsSslemkn2j5qRE/edit?usp=sharing") sample doument].

    div
      input(type='submit', value='Show map')

  h2 Result
  div#demoMap
  p
    a(href="/clean?"+queryString) Open map in new window

  h2 thenmap.js settings
  p Use the below code to put this map on a web page.
  pre
    code.prettyprint
      |&lt;div id="map"&gt;&lt;/div&gt;
      |&lt;script src="//drvkoaf101245.cloudfront.net/thenmap-1.0.5.min.js"&gt;&lt;/script&gt;
      |var settings = {
      |  dataKey: "!{activeDatakey}",
      |  dataset: "!{activeDataset}",
      |  date: "!{date}"
      |  language: "#{activeLanguage}",
      |  projection: "#{requestedProjection}",
      |  width:!{width},
      |  height:!{height}
      |};
      |Thenmap.init("map", settings);

  h2 API calls
  p Use one these API endpoints to fetch data to produce the map above. See #[a(href="http://api.thenmap.net/") the API documentation] for details.
  p Geojson:
    code http://api.thenmap.net/v1/#{activeDataset}/geo/#{date}
  p Topojson:
    code http://api.thenmap.net/v1/#{activeDataset}/geo/#{date}?geo_type=topojson
  p SVG
    code http://api.thenmap.net/v1/#{activeDataset}/svg/#{date}?svg_proj=#{requestedProjection}
  p Data
    code http://api.thenmap.net/v1/#{activeDataset}/data/#{date}?data_lang=#{activeLanguage}&data_props=name|is_in|etc...

  if env == 'development'
    script(src="/js/thenmap-1.0.5.min.js")
    script.
      Thenmap.debug=true;
  else
    script(src="//drvkoaf101245.cloudfront.net/thenmap-1.0.5.min.js")
  script var dataset = ""
  script.
    var settings = {
          dataKey: "!{activeDatakey}",
          dataset: "!{activeDataset}",
          date: "!{date}",
          language: "#{activeLanguage}",
          projection: "#{requestedProjection}",
          width:!{width},
          height:!{height},
        }
    Thenmap.init("demoMap", settings);
